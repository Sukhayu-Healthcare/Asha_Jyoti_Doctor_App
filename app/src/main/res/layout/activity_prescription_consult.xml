<?xml version="1.0" encoding="utf-8"?>
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
    android:id="@+id/rootLayout"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:orientation="vertical"
    android:background="#f4f6f8">

    <!-- Fixed header -->
    <LinearLayout
        android:id="@+id/header"
        android:layout_width="match_parent"
        android:layout_height="68dp"
        android:orientation="horizontal"
        android:background="#072440"
        android:gravity="center_vertical"
        android:paddingStart="16dp"
        android:paddingEnd="16dp">

        <ImageView
            android:id="@+id/headerImage"
            android:layout_width="40dp"
            android:layout_height="40dp"
            android:src="@drawable/asha_jyoti_app_logo"
            android:contentDescription="logo"
            android:scaleType="centerCrop" />

        <TextView
            android:id="@+id/headerTitle"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:layout_marginStart="12dp"
            android:text="PRESCRIPTION"
            android:textColor="#FFFFFF"
            android:textSize="20sp"
            android:textStyle="bold" />
    </LinearLayout>

    <!-- Scrollable content -->
    <ScrollView
        android:id="@+id/scroll"
        android:layout_width="match_parent"
        android:layout_height="0dp"
        android:layout_weight="1"
        android:fillViewport="true"
        android:padding="12dp">

        <LinearLayout
            android:id="@+id/contentContainer"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:orientation="vertical">

            <!-- Patient card (unchanged) -->
            <LinearLayout
                android:id="@+id/cardPatient"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:orientation="vertical"
                android:background="@android:color/white"
                android:padding="14dp"
                android:layout_marginBottom="12dp">

                <TextView
                    android:layout_width="wrap_content"
                    android:layout_height="wrap_content"
                    android:text="Patient and Examination"
                    android:textStyle="bold"
                    android:textSize="16sp"
                    android:paddingBottom="8dp" />

                <!-- Patient fields -->
                <TextView android:layout_width="match_parent" android:layout_height="wrap_content"
                    android:text="Patient name *" android:textSize="12sp" />
                <EditText
                    android:id="@+id/etPatientName"
                    android:layout_width="match_parent"
                    android:layout_height="wrap_content"
                    android:inputType="textPersonName" />

                <TextView android:layout_width="match_parent" android:layout_height="wrap_content"
                    android:text="Patient ID *" android:textSize="12sp" android:layout_marginTop="8dp"/>
                <EditText
                    android:id="@+id/etPatientId"
                    android:layout_width="match_parent"
                    android:layout_height="wrap_content"
                    android:inputType="text" />

                <TextView android:layout_width="match_parent" android:layout_height="wrap_content"
                    android:text="Patient phone *" android:textSize="12sp" android:layout_marginTop="8dp"/>
                <EditText
                    android:id="@+id/etPatientPhone"
                    android:layout_width="match_parent"
                    android:layout_height="wrap_content"
                    android:inputType="phone" />

                <TextView android:layout_width="match_parent" android:layout_height="wrap_content"
                    android:text="Date and time" android:textSize="12sp" android:layout_marginTop="8dp"/>
                <EditText
                    android:id="@+id/etDate"
                    android:layout_width="match_parent"
                    android:layout_height="wrap_content"
                    android:focusable="false"
                    android:clickable="true"
                    android:hint="Select date and time" />

                <View android:layout_width="match_parent" android:layout_height="1dp" android:background="#e6eef6" android:layout_marginTop="12dp" />

                <!-- Vitals rows -->
                <TextView android:layout_width="match_parent" android:layout_height="wrap_content"
                    android:text="Vitals" android:textStyle="bold" android:layout_marginTop="8dp"/>

                <!-- Row 1: BP + Heart Rate -->
                <LinearLayout android:layout_width="match_parent" android:layout_height="wrap_content" android:orientation="horizontal">
                    <LinearLayout
                        android:layout_width="0dp"
                        android:layout_height="wrap_content"
                        android:layout_weight="1"
                        android:orientation="vertical"
                        android:paddingEnd="6dp">
                        <TextView android:layout_width="wrap_content" android:layout_height="wrap_content" android:text="Blood Pressure (mmHg)" android:textSize="12sp"/>
                        <EditText android:id="@+id/etBP" android:layout_width="match_parent" android:layout_height="wrap_content" />
                    </LinearLayout>

                    <LinearLayout
                        android:layout_width="0dp"
                        android:layout_height="wrap_content"
                        android:layout_weight="1"
                        android:orientation="vertical"
                        android:paddingStart="6dp">
                        <TextView android:layout_width="wrap_content" android:layout_height="wrap_content" android:text="Heart Rate (bpm)" android:textSize="12sp"/>
                        <EditText android:id="@+id/etHR" android:layout_width="match_parent" android:layout_height="wrap_content" android:inputType="number"/>
                    </LinearLayout>
                </LinearLayout>

                <!-- Row 2: Temp + Oxygen -->
                <LinearLayout android:layout_width="match_parent" android:layout_height="wrap_content" android:orientation="horizontal" android:paddingTop="6dp">
                    <LinearLayout
                        android:layout_width="0dp"
                        android:layout_height="wrap_content"
                        android:layout_weight="1"
                        android:orientation="vertical"
                        android:paddingEnd="6dp">
                        <TextView android:layout_width="wrap_content" android:layout_height="wrap_content" android:text="Temperature (°F)" android:textSize="12sp"/>
                        <EditText android:id="@+id/etTemp" android:layout_width="match_parent" android:layout_height="wrap_content" android:inputType="numberDecimal"/>
                    </LinearLayout>

                    <LinearLayout
                        android:layout_width="0dp"
                        android:layout_height="wrap_content"
                        android:layout_weight="1"
                        android:orientation="vertical"
                        android:paddingStart="6dp">
                        <TextView android:layout_width="wrap_content" android:layout_height="wrap_content" android:text="Oxygen Sat (%)" android:textSize="12sp"/>
                        <EditText android:id="@+id/etOxygen" android:layout_width="match_parent" android:layout_height="wrap_content" android:inputType="number"/>
                    </LinearLayout>
                </LinearLayout>

                <!-- Row 3: Weight + Height -->
                <LinearLayout android:layout_width="match_parent" android:layout_height="wrap_content" android:orientation="horizontal" android:paddingTop="6dp">
                    <LinearLayout
                        android:layout_width="0dp"
                        android:layout_height="wrap_content"
                        android:layout_weight="1"
                        android:orientation="vertical"
                        android:paddingEnd="6dp">
                        <TextView android:layout_width="wrap_content" android:layout_height="wrap_content" android:text="Weight (kg)" android:textSize="12sp"/>
                        <EditText android:id="@+id/etWeight" android:layout_width="match_parent" android:layout_height="wrap_content" android:inputType="numberDecimal"/>
                    </LinearLayout>

                    <LinearLayout
                        android:layout_width="0dp"
                        android:layout_height="wrap_content"
                        android:layout_weight="1"
                        android:orientation="vertical"
                        android:paddingStart="6dp">
                        <TextView android:layout_width="wrap_content" android:layout_height="wrap_content" android:text="Height (cm)" android:textSize="12sp"/>
                        <EditText android:id="@+id/etHeight" android:layout_width="match_parent" android:layout_height="wrap_content" android:inputType="numberDecimal"/>
                    </LinearLayout>
                </LinearLayout>

                <!-- Clinical exam -->
                <!-- <View android:layout_width="match_parent" android:layout_height="1dp" android:background="#e6eef6" android:layout_marginTop="12dp" />
                <TextView android:layout_width="match_parent" android:layout_height="wrap_content" android:text="Clinical Examination" android:textStyle="bold" android:layout_marginTop="8dp"/> -->

                <!--
                Commented out per request: Diagnosis + Clinical notes (no other changes)
                <TextView android:layout_width="match_parent" android:layout_height="wrap_content" android:text="Diagnosis" android:textSize="12sp" />
                <EditText android:id="@+id/etDiagnosis" android:layout_width="match_parent" android:layout_height="wrap_content" android:minLines="2" android:inputType="textMultiLine"/>
                <TextView android:layout_width="match_parent" android:layout_height="wrap_content" android:text="Clinical notes" android:textSize="12sp" android:layout_marginTop="8dp"/>
                <EditText android:id="@+id/etClinical" android:layout_width="match_parent" android:layout_height="wrap_content" android:minLines="3" android:inputType="textMultiLine"/>
                -->

            </LinearLayout>

            <!-- =========================
                 PRESCRIPTION: TABLE-STYLE
                 ========================= -->
            <LinearLayout
                android:id="@+id/cardPrescription"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:orientation="vertical"
                android:background="@android:color/white"
                android:padding="14dp"
                android:layout_marginBottom="12dp">

                <!-- Header row: Prescription title + Add button on same row -->
                <LinearLayout
                    android:layout_width="match_parent"
                    android:layout_height="wrap_content"
                    android:orientation="horizontal"
                    android:gravity="center_vertical">

                    <TextView
                        android:layout_width="0dp"
                        android:layout_weight="1"
                        android:layout_height="wrap_content"
                        android:text="Prescription"
                        android:textStyle="bold"
                        android:textSize="16sp" />

                    <Button
                        android:id="@+id/btnAddMed"
                        android:layout_width="wrap_content"
                        android:layout_height="wrap_content"
                        android:text="+ Add Medicine" />
                </LinearLayout>

                <!-- TABLE HEADER -->
                <LinearLayout
                    android:layout_width="match_parent"
                    android:layout_height="wrap_content"
                    android:orientation="horizontal"
                    android:paddingTop="10dp"
                    android:paddingBottom="6dp">

                    <TextView
                        android:layout_width="0dp"
                        android:layout_weight="1"
                        android:layout_height="wrap_content"
                        android:text="Medicine Name"
                        android:textStyle="bold"/>

                    <TextView
                        android:layout_width="0dp"
                        android:layout_weight="1"
                        android:layout_height="wrap_content"
                        android:text="Dosage"
                        android:textStyle="bold"/>

                    <TextView
                        android:layout_width="0dp"
                        android:layout_weight="1"
                        android:layout_height="wrap_content"
                        android:text="Frequency"
                        android:textStyle="bold"/>

                    <TextView
                        android:layout_width="0dp"
                        android:layout_weight="1"
                        android:layout_height="wrap_content"
                        android:text="Duration"
                        android:textStyle="bold"/>
                </LinearLayout>

                <!-- Rows container — dynamic rows will be added here by Kotlin -->
                <LinearLayout
                    android:id="@+id/rowsContainer"
                    android:layout_width="match_parent"
                    android:layout_height="wrap_content"
                    android:orientation="vertical">

                    <!-- DEFAULT ROW (one row by default) -->
                    <LinearLayout
                        android:layout_width="match_parent"
                        android:layout_height="wrap_content"
                        android:orientation="horizontal"
                        android:paddingTop="6dp"
                        android:paddingBottom="6dp">

                        <EditText
                            android:id="@+id/default_etMedName"
                            android:layout_width="0dp"
                            android:layout_weight="1"
                            android:layout_height="wrap_content"
                            android:hint="Name"/>

                        <EditText
                            android:id="@+id/default_etDosage"
                            android:layout_width="0dp"
                            android:layout_weight="1"
                            android:layout_height="wrap_content"
                            android:hint="Dosage"/>

                        <Spinner
                            android:id="@+id/default_spFreq"
                            android:layout_width="0dp"
                            android:layout_weight="1"
                            android:layout_height="wrap_content"/>

                        <EditText
                            android:id="@+id/default_etDuration"
                            android:layout_width="0dp"
                            android:layout_weight="1"
                            android:layout_height="wrap_content"
                            android:hint="Days"/>
                    </LinearLayout>

                </LinearLayout>

                <!-- Hidden compatibility views (keeps older code from crashing) -->
                <androidx.recyclerview.widget.RecyclerView
                    android:id="@+id/rvMeds"
                    android:layout_width="match_parent"
                    android:layout_height="wrap_content"
                    android:visibility="gone" />

                <LinearLayout
                    android:layout_width="match_parent"
                    android:layout_height="wrap_content"
                    android:orientation="horizontal"
                    android:visibility="gone">

                    <Button
                        android:id="@+id/btnPreview"
                        android:layout_width="wrap_content"
                        android:layout_height="wrap_content"
                        android:text="Preview" />

                    <TextView
                        android:id="@+id/tvMedError"
                        android:layout_width="wrap_content"
                        android:layout_height="wrap_content"
                        android:text="At least one medicine required"
                        android:visibility="gone"/>
                </LinearLayout>

            </LinearLayout>
            <!-- ========================= END PRESCRIPTION ========================= -->

            <!-- Follow-up -->
            <TextView android:layout_width="match_parent" android:layout_height="wrap_content"
                android:text="Follow-up / Additional instructions" android:layout_marginTop="4dp" />
            <EditText android:id="@+id/etFollowup" android:layout_width="match_parent" android:layout_height="wrap_content" android:minLines="2" android:layout_marginBottom="16dp"/>

            <!-- Bottom actions -->
            <LinearLayout android:layout_width="match_parent" android:layout_height="wrap_content" android:orientation="horizontal" android:gravity="center">
                <Button android:id="@+id/btnReset" android:layout_width="wrap_content" android:layout_height="wrap_content" android:text="Reset" />
                <Button android:id="@+id/btnConfirm" android:layout_width="wrap_content" android:layout_height="wrap_content" android:text="Confirm and Save" android:layout_marginStart="12dp" />
            </LinearLayout>

        </LinearLayout>
    </ScrollView>
</LinearLayout>
